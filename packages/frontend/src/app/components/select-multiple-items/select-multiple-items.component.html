<div>
  <div
    class="selected-container ion-padding-start ion-padding-end"
    [class.reserve-height]="reserveSelectedItemsHeight"
  >
    @if (reserveSelectedItemsHeight && selectedItems.length === 0) {
      <ion-chip>
        {{
          noSelectedItemsText || "components.selectMultipleItems.noSelected"
            | translate
        }}
      </ion-chip>
    }

    @for (
      selectedItem of selectedItems;
      track itemTrackBy($index, selectedItem)
    ) {
      <ion-chip (click)="deselectItem(selectedItem)">
        @if (selectedItem.image) {
          <ion-avatar aria-hidden="true">
            <img alt="Selected item image" [src]="selectedItem.image" />
          </ion-avatar>
        }
        @if (selectedItem.icon) {
          <ion-icon [name]="selectedItem.icon"></ion-icon>
        }
        <ion-label>
          {{ selectedItem.title }}
        </ion-label>
        <ion-icon name="trash" color="danger"></ion-icon>
      </ion-chip>
    }
  </div>

  <div
    class="search-container"
    [class.reserve-height]="reserveSearchResultsHeight"
  >
    <ion-searchbar
      (ionInput)="onSearchInputChange($event)"
      (ionFocus)="onSearchFocus($event)"
      (ionBlur)="onSearchBlur()"
      (keydown.enter)="onEnter()"
      enterkeyhint="go"
      [value]="searchText"
      placeholder="{{
        searchPlaceholderText ||
          'components.selectMultipleItems.searchPlaceholder' | translate
      }}"
      autocomplete="off"
    ></ion-searchbar>
    <div class="ion-padding-start ion-padding-end">
      @if (searchText.length || searchFocused) {
        <div class="results-list-container">
          <div class="results-list">
            @if (!searchResults.length && !searchText.length) {
              <ion-item>
                @if (noItemsText) {
                  <ion-label>
                    {{ noItemsText }}
                  </ion-label>
                }
                @if (!noItemsText) {
                  <ion-label>
                    {{ "components.selectMultipleItems.noItems" | translate }}
                  </ion-label>
                }
              </ion-item>
            }
            @for (result of searchResults; track itemTrackBy($index, result)) {
              <ion-item
                (mousedown)="$event.preventDefault()"
                (click)="selectItem(result)"
                button
              >
                @if (result.image) {
                  <ion-avatar aria-hidden="true" slot="start">
                    <img alt="Image of selectable item" [src]="result.image" />
                  </ion-avatar>
                }
                @if (result.icon) {
                  <ion-icon
                    aria-hidden="true"
                    [name]="result.icon"
                    slot="start"
                  ></ion-icon>
                }
                <ion-label>
                  <h2>{{ result.title }}</h2>
                  <p>
                    {{ "components.selectMultipleItems.select" | translate }}
                  </p>
                </ion-label>
              </ion-item>
            }
            @if (exactItemMatch && isSelected(exactItemMatch)) {
              <ion-item>
                @if (exactItemMatch.image) {
                  <ion-avatar aria-hidden="true" slot="start">
                    <img
                      alt="Image of selectable item"
                      [src]="exactItemMatch.image"
                    />
                  </ion-avatar>
                }
                @if (exactItemMatch.icon) {
                  <ion-icon
                    aria-hidden="true"
                    [name]="exactItemMatch.icon"
                    slot="start"
                  ></ion-icon>
                }
                <ion-label>
                  <h2>{{ exactItemMatch.title }}</h2>
                  <p>
                    {{
                      "components.selectMultipleItems.alreadyAdded" | translate
                    }}
                  </p>
                </ion-label>
              </ion-item>
            }
            @if (
              !enableCreateNew && !searchResults.length && searchText.length > 0
            ) {
              <ion-item>
                <ion-icon
                  aria-hidden="true"
                  name="folder-open"
                  slot="start"
                ></ion-icon>
                <ion-label>
                  <h2>
                    {{
                      "components.selectMultipleItems.null"
                        | translate: { searchText: searchText }
                    }}
                  </h2>
                </ion-label>
              </ion-item>
            }
            @if (
              enableCreateNew &&
              !exactItemMatch &&
              searchText.length > 0 &&
              !disallowedTitles[searchText]
            ) {
              <ion-item
                (mousedown)="$event.preventDefault()"
                (click)="create()"
                button
              >
                <ion-icon aria-hidden="true" name="add" slot="start"></ion-icon>
                <ion-label>
                  <h2>{{ searchText }}</h2>
                  <p>
                    {{ "components.selectMultipleItems.create" | translate }}
                  </p>
                </ion-label>
              </ion-item>
            }
            @if (
              enableCreateNew &&
              !exactItemMatch &&
              searchText.length > 0 &&
              disallowedTitles[searchText]
            ) {
              <ion-item>
                <ion-icon aria-hidden="true" name="ban" slot="start"></ion-icon>
                <ion-label>
                  <h2>{{ searchText }}</h2>
                  <p>
                    {{ disallowedTitles[searchText] | translate }}
                  </p>
                </ion-label>
              </ion-item>
            }
          </div>
        </div>
      }
    </div>
  </div>
</div>
